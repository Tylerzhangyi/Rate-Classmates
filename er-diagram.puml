@startuml RateMyClassmateER
title Rate My Classmate 平台 ER 图

entity Student {
  *student_id : UUID
  ---
  school_id : UUID
  name : string
  grade : int
  class_no : int
  account : string
  password_hash : string
  created_at : datetime
}

entity School {
  *school_id : UUID
  ---
  school_name : string
  created_at : datetime
}

entity Rating {
  *rating_id : UUID
  ---
  rater_id : UUID
  target_id : UUID
  score : int
  comment : text
  created_at : datetime
}

entity RatingSummary {
  *target_id : UUID
  ---
  avg_score : float
  rating_count : int
  last_update : datetime
}

entity Badge {
  *badge_id : UUID
  ---
  name : string
  description : string
  badge_type : enum
  rule_desc : text
}

entity StudentBadge {
  *student_badge_id : UUID
  ---
  student_id : UUID
  badge_id : UUID
  period : string
  awarded_at : datetime
}

entity SchoolBadge {
  *school_badge_id : UUID
  ---
  school_id : UUID
  badge_id : UUID
  period : string
  awarded_at : datetime
}

entity Leaderboard {
  *leaderboard_id : UUID
  ---
  name : string
  type : string
  formula : text
}

entity LeaderboardEntry {
  *entry_id : UUID
  ---
  leaderboard_id : UUID
  student_id : UUID
  rank : int
  score : decimal
}

School ||--o{ Student : hosts
Student ||--o{ Rating : submits
Student ||--o{ Rating : receives
Student ||--|| RatingSummary : summarized_by
Rating ||--|| RatingSummary : updates
Student ||--o{ StudentBadge : earns
Badge ||--o{ StudentBadge : assigned
School ||--o{ SchoolBadge : decorated_by
Badge ||--o{ SchoolBadge : assigned
Leaderboard ||--o{ LeaderboardEntry : contains
Student ||--o{ LeaderboardEntry : ranks

@enduml

@enduml

